<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Secret Link Created - go-read-burn</title>
    <link rel="stylesheet" href="/static/css/app.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="container-md center">
                <a class="navbar-brand" href="/">go-read-burn</a>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="container-md center">
            <div class="mt-3">
                <div class="alert alert-success" role="alert">
                    <h4 class="alert-heading">Secret link created successfully!</h4>
                    <p class="mb-0">Share this link. It can only be viewed once and expires in {{.ExpiryDays}} days.</p>
                </div>
                <div class="mb-3">
                    <label for="shareUrl" class="form-label">Your shareable link:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="shareUrl" value="{{.ShareURL}}" readonly>
                        <button class="btn btn-primary" type="button" id="copyButton" aria-label="Copy to Clipboard">
                            Copy to Clipboard
                        </button>
                    </div>
                    <div id="copyFeedback" class="form-text text-success d-none">
                        âœ“ Link copied to clipboard!
                    </div>
                </div>
                <div class="alert alert-warning" role="alert">
                    <strong>Security Warning:</strong> Never share the link in the same message as the username/password.
                </div>
                <div class="mt-3">
                    <a href="/" class="btn btn-secondary">Create Another Secret</a>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        // Copy to clipboard functionality with modern API and fallback
        document.getElementById('copyButton').addEventListener('click', function(event) {
            const urlInput = document.getElementById('shareUrl');
            const feedback = document.getElementById('copyFeedback');
            const button = event.currentTarget;

            // Try modern Clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(urlInput.value)
                    .then(function() {
                        // Show success feedback
                        button.textContent = 'Copied!';
                        feedback.classList.remove('d-none');

                        // Reset button text after 2 seconds
                        setTimeout(function() {
                            button.textContent = 'Copy to Clipboard';
                            feedback.classList.add('d-none');
                        }, 2000);
                    })
                    .catch(function(err) {
                        console.error('Clipboard API failed:', err);
                        // Fallback to legacy method
                        fallbackCopy();
                    });
            } else {
                // Use fallback for older browsers
                fallbackCopy();
            }

            function fallbackCopy() {
                // Select the text
                urlInput.select();
                urlInput.setSelectionRange(0, 99999); // For mobile devices

                try {
                    // Execute copy command
                    const successful = document.execCommand('copy');
                    if (successful) {
                        button.textContent = 'Copied!';
                        feedback.classList.remove('d-none');

                        setTimeout(function() {
                            button.textContent = 'Copy to Clipboard';
                            feedback.classList.add('d-none');
                        }, 2000);
                    } else {
                        alert('Failed to copy. Please copy the link manually.');
                    }
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    alert('Failed to copy. Please copy the link manually.');
                }

                // Remove selection
                globalThis.getSelection().removeAllRanges();
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
</body>

</html>
